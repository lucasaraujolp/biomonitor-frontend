<div class="flex justify-between mb-6">
  <h1 class="text-2xl font-bold">Sensores</h1>

  <button
    type="button"
    (click)="toggleForm()"
    class="bg-emerald-600 text-white px-4 py-2 rounded-xl">
    + Novo Sensor
  </button>
</div>

@if (showForm()) {
  <div class="bg-slate-50 border border-slate-200 p-6 rounded-2xl shadow-sm mb-6">

    <h2 class="text-lg font-bold text-slate-800 mb-6">
      Cadastrar Sensor
    </h2>

    <form
      [formGroup]="form"
      (ngSubmit)="salvar()"
      class="grid grid-cols-2 gap-5">

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Serial
        </label>
        <input
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white text-slate-800 placeholder-slate-400
                 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          placeholder="SN-000123"
          formControlName="serialNumber">
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Fabricante
        </label>
        <input
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          placeholder="Ex: Bosch"
          formControlName="fabricante">
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Modelo
        </label>
        <input
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          placeholder="X100"
          formControlName="modelo">
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Tipo de Sensor
        </label>
        <input
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          placeholder="Temperatura, Umidade..."
          formControlName="tipo">
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Status
        </label>
        <select
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white
                 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          formControlName="status">
          <option value="">Selecione</option>
          @for (s of statusList; track s) {
            <option [value]="s">{{ s }}</option>
          }
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Área
        </label>
        <select
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white
                 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          formControlName="areaId">
          <option value="">Selecione</option>
          @for (a of areas(); track a.id) {
            <option [value]="a.id">{{ a.nome }}</option>
          }
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Latitude
        </label>
        <input
          type="number"
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          placeholder="-3.10"
          formControlName="latitude">
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Longitude
        </label>
        <input
          type="number"
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          placeholder="-60.01"
          formControlName="longitude">
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Ciclo de Leitura (s)
        </label>
        <input
          type="number"
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          placeholder="60"
          formControlName="cicloLeitura">
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 mb-1">
          Data de Instalação
        </label>
        <input
          type="date"
          class="w-full px-4 py-2.5 rounded-xl border border-slate-300
                 bg-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
          formControlName="dataInstalacao">
      </div>

      <div class="col-span-2 flex gap-3 pt-2">
        <button
          type="submit"
          [disabled]="form.invalid"
          class="bg-emerald-600 hover:bg-emerald-700 disabled:bg-slate-300
                 text-white px-6 py-2.5 rounded-xl font-semibold transition">
          Salvar
        </button>

        <button
          type="button"
          (click)="toggleForm()"
          class="px-6 py-2.5 rounded-xl text-slate-600 hover:bg-slate-200 transition">
          Cancelar
        </button>
      </div>

    </form>
  </div>
}


<table class="bg-white w-full rounded-xl shadow">
  <thead>
    <tr class="bg-slate-100">
      <th class="p-3">Serial</th>
      <th>Status</th>
      <th>Área</th>
    </tr>
  </thead>

  <tbody>
    @for (s of sensores(); track s.id) {
      <tr class="border-t">
        <td class="p-3">{{ s.serialNumber }}</td>
        <td>{{ s.status }}</td>
        <td>{{ s.area?.nome }}</td>
      </tr>
    }
  </tbody>
</table>
